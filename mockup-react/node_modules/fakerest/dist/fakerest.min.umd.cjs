(function(p,$){typeof exports=="object"&&typeof module<"u"?$(exports):typeof define=="function"&&define.amd?define(["exports"],$):(p=typeof globalThis<"u"?globalThis:p||self,$(p.FakeRest={}))})(this,function(p){"use strict";var th=Object.defineProperty;var rh=(p,$,O)=>$ in p?th(p,$,{enumerable:!0,configurable:!0,writable:!0,value:O}):p[$]=O;var b=(p,$,O)=>rh(p,typeof $!="symbol"?$+"":$,O);var $=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function O(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Jt=Array.isArray,S=Jt,Qt=typeof $=="object"&&$&&$.Object===Object&&$,Se=Qt,Wt=Se,Yt=typeof self=="object"&&self&&self.Object===Object&&self,Xt=Wt||Yt||Function("return this")(),T=Xt,Zt=T,kt=Zt.Symbol,D=kt,Ce=D,je=Object.prototype,er=je.hasOwnProperty,tr=je.toString,F=Ce?Ce.toStringTag:void 0;function rr(e){var t=er.call(e,F),r=e[F];try{e[F]=void 0;var a=!0}catch{}var n=tr.call(e);return a&&(t?e[F]=r:delete e[F]),n}var ar=rr,nr=Object.prototype,sr=nr.toString;function ir(e){return sr.call(e)}var or=ir,Ee=D,cr=ar,lr=or,ur="[object Null]",fr="[object Undefined]",Ie=Ee?Ee.toStringTag:void 0;function dr(e){return e==null?e===void 0?fr:ur:Ie&&Ie in Object(e)?cr(e):lr(e)}var B=dr;function hr(e){return e!=null&&typeof e=="object"}var C=hr,gr=B,pr=C,yr="[object Symbol]";function br(e){return typeof e=="symbol"||pr(e)&&gr(e)==yr}var re=br,vr=S,$r=re,_r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mr=/^\w*$/;function Ar(e,t){if(vr(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||$r(e)?!0:mr.test(e)||!_r.test(e)||t!=null&&e in Object(t)}var wr=Ar;function Tr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var P=Tr,Or=B,Sr=P,Cr="[object AsyncFunction]",jr="[object Function]",Er="[object GeneratorFunction]",Ir="[object Proxy]";function Pr(e){if(!Sr(e))return!1;var t=Or(e);return t==jr||t==Er||t==Cr||t==Ir}var Pe=Pr,xr=T,Mr=xr["__core-js_shared__"],Nr=Mr,ae=Nr,xe=function(){var e=/[^.]+$/.exec(ae&&ae.keys&&ae.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Lr(e){return!!xe&&xe in e}var Rr=Lr,Dr=Function.prototype,Fr=Dr.toString;function Br(e){if(e!=null){try{return Fr.call(e)}catch{}try{return e+""}catch{}}return""}var Me=Br,Ur=Pe,Gr=Rr,Kr=P,Hr=Me,qr=/[\\^$.*+?()[\]{}|]/g,Vr=/^\[object .+?Constructor\]$/,zr=Function.prototype,Jr=Object.prototype,Qr=zr.toString,Wr=Jr.hasOwnProperty,Yr=RegExp("^"+Qr.call(Wr).replace(qr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Xr(e){if(!Kr(e)||Gr(e))return!1;var t=Ur(e)?Yr:Vr;return t.test(Hr(e))}var Zr=Xr;function kr(e,t){return e==null?void 0:e[t]}var ea=kr,ta=Zr,ra=ea;function aa(e,t){var r=ra(e,t);return ta(r)?r:void 0}var j=aa,na=j,sa=na(Object,"create"),U=sa,Ne=U;function ia(){this.__data__=Ne?Ne(null):{},this.size=0}var oa=ia;function ca(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var la=ca,ua=U,fa="__lodash_hash_undefined__",da=Object.prototype,ha=da.hasOwnProperty;function ga(e){var t=this.__data__;if(ua){var r=t[e];return r===fa?void 0:r}return ha.call(t,e)?t[e]:void 0}var pa=ga,ya=U,ba=Object.prototype,va=ba.hasOwnProperty;function $a(e){var t=this.__data__;return ya?t[e]!==void 0:va.call(t,e)}var _a=$a,ma=U,Aa="__lodash_hash_undefined__";function wa(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ma&&t===void 0?Aa:t,this}var Ta=wa,Oa=oa,Sa=la,Ca=pa,ja=_a,Ea=Ta;function x(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}x.prototype.clear=Oa,x.prototype.delete=Sa,x.prototype.get=Ca,x.prototype.has=ja,x.prototype.set=Ea;var Ia=x;function Pa(){this.__data__=[],this.size=0}var xa=Pa;function Ma(e,t){return e===t||e!==e&&t!==t}var ne=Ma,Na=ne;function La(e,t){for(var r=e.length;r--;)if(Na(e[r][0],t))return r;return-1}var G=La,Ra=G,Da=Array.prototype,Fa=Da.splice;function Ba(e){var t=this.__data__,r=Ra(t,e);if(r<0)return!1;var a=t.length-1;return r==a?t.pop():Fa.call(t,r,1),--this.size,!0}var Ua=Ba,Ga=G;function Ka(e){var t=this.__data__,r=Ga(t,e);return r<0?void 0:t[r][1]}var Ha=Ka,qa=G;function Va(e){return qa(this.__data__,e)>-1}var za=Va,Ja=G;function Qa(e,t){var r=this.__data__,a=Ja(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this}var Wa=Qa,Ya=xa,Xa=Ua,Za=Ha,ka=za,en=Wa;function M(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}M.prototype.clear=Ya,M.prototype.delete=Xa,M.prototype.get=Za,M.prototype.has=ka,M.prototype.set=en;var K=M,tn=j,rn=T,an=tn(rn,"Map"),se=an,Le=Ia,nn=K,sn=se;function on(){this.size=0,this.__data__={hash:new Le,map:new(sn||nn),string:new Le}}var cn=on;function ln(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var un=ln,fn=un;function dn(e,t){var r=e.__data__;return fn(t)?r[typeof t=="string"?"string":"hash"]:r.map}var H=dn,hn=H;function gn(e){var t=hn(this,e).delete(e);return this.size-=t?1:0,t}var pn=gn,yn=H;function bn(e){return yn(this,e).get(e)}var vn=bn,$n=H;function _n(e){return $n(this,e).has(e)}var mn=_n,An=H;function wn(e,t){var r=An(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this}var Tn=wn,On=cn,Sn=pn,Cn=vn,jn=mn,En=Tn;function N(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}N.prototype.clear=On,N.prototype.delete=Sn,N.prototype.get=Cn,N.prototype.has=jn,N.prototype.set=En;var ie=N,Re=ie,In="Expected a function";function oe(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(In);var r=function(){var a=arguments,n=t?t.apply(this,a):a[0],s=r.cache;if(s.has(n))return s.get(n);var i=e.apply(this,a);return r.cache=s.set(n,i)||s,i};return r.cache=new(oe.Cache||Re),r}oe.Cache=Re;var Pn=oe,xn=Pn,Mn=500;function Nn(e){var t=xn(e,function(a){return r.size===Mn&&r.clear(),a}),r=t.cache;return t}var Ln=Nn,Rn=Ln,Dn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Fn=/\\(\\)?/g,Bn=Rn(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Dn,function(r,a,n,s){t.push(n?s.replace(Fn,"$1"):a||r)}),t}),Un=Bn;function Gn(e,t){for(var r=-1,a=e==null?0:e.length,n=Array(a);++r<a;)n[r]=t(e[r],r,e);return n}var Kn=Gn,De=D,Hn=Kn,qn=S,Vn=re,zn=1/0,Fe=De?De.prototype:void 0,Be=Fe?Fe.toString:void 0;function Ue(e){if(typeof e=="string")return e;if(qn(e))return Hn(e,Ue)+"";if(Vn(e))return Be?Be.call(e):"";var t=e+"";return t=="0"&&1/e==-zn?"-0":t}var Jn=Ue,Qn=Jn;function Wn(e){return e==null?"":Qn(e)}var Yn=Wn,Xn=S,Zn=wr,kn=Un,es=Yn;function ts(e,t){return Xn(e)?e:Zn(e,t)?[e]:kn(es(e))}var rs=ts,as=re,ns=1/0;function ss(e){if(typeof e=="string"||as(e))return e;var t=e+"";return t=="0"&&1/e==-ns?"-0":t}var is=ss,os=rs,cs=is;function ls(e,t){t=os(t,e);for(var r=0,a=t.length;e!=null&&r<a;)e=e[cs(t[r++])];return r&&r==a?e:void 0}var us=ls,fs=us;function ds(e,t,r){var a=e==null?void 0:fs(e,t);return a===void 0?r:a}var hs=ds;const y=O(hs);var gs=K;function ps(){this.__data__=new gs,this.size=0}var ys=ps;function bs(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var vs=bs;function $s(e){return this.__data__.get(e)}var _s=$s;function ms(e){return this.__data__.has(e)}var As=ms,ws=K,Ts=se,Os=ie,Ss=200;function Cs(e,t){var r=this.__data__;if(r instanceof ws){var a=r.__data__;if(!Ts||a.length<Ss-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new Os(a)}return r.set(e,t),this.size=r.size,this}var js=Cs,Es=K,Is=ys,Ps=vs,xs=_s,Ms=As,Ns=js;function L(e){var t=this.__data__=new Es(e);this.size=t.size}L.prototype.clear=Is,L.prototype.delete=Ps,L.prototype.get=xs,L.prototype.has=Ms,L.prototype.set=Ns;var ce=L;function Ls(e,t){for(var r=-1,a=e==null?0:e.length;++r<a&&t(e[r],r,e)!==!1;);return e}var Rs=Ls,Ds=j,Fs=function(){try{var e=Ds(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Bs=Fs,Ge=Bs;function Us(e,t,r){t=="__proto__"&&Ge?Ge(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var Ke=Us,Gs=Ke,Ks=ne,Hs=Object.prototype,qs=Hs.hasOwnProperty;function Vs(e,t,r){var a=e[t];(!(qs.call(e,t)&&Ks(a,r))||r===void 0&&!(t in e))&&Gs(e,t,r)}var He=Vs,zs=He,Js=Ke;function Qs(e,t,r,a){var n=!r;r||(r={});for(var s=-1,i=t.length;++s<i;){var o=t[s],c=a?a(r[o],e[o],o,r,e):void 0;c===void 0&&(c=e[o]),n?Js(r,o,c):zs(r,o,c)}return r}var q=Qs;function Ws(e,t){for(var r=-1,a=Array(e);++r<e;)a[r]=t(r);return a}var Ys=Ws,Xs=B,Zs=C,ks="[object Arguments]";function ei(e){return Zs(e)&&Xs(e)==ks}var ti=ei,qe=ti,ri=C,Ve=Object.prototype,ai=Ve.hasOwnProperty,ni=Ve.propertyIsEnumerable,si=qe(function(){return arguments}())?qe:function(e){return ri(e)&&ai.call(e,"callee")&&!ni.call(e,"callee")},ii=si,V={exports:{}};function oi(){return!1}var ci=oi;V.exports,function(e,t){var r=T,a=ci,n=t&&!t.nodeType&&t,s=n&&!0&&e&&!e.nodeType&&e,i=s&&s.exports===n,o=i?r.Buffer:void 0,c=o?o.isBuffer:void 0,l=c||a;e.exports=l}(V,V.exports);var le=V.exports,li=9007199254740991,ui=/^(?:0|[1-9]\d*)$/;function fi(e,t){var r=typeof e;return t=t??li,!!t&&(r=="number"||r!="symbol"&&ui.test(e))&&e>-1&&e%1==0&&e<t}var di=fi,hi=9007199254740991;function gi(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=hi}var ze=gi,pi=B,yi=ze,bi=C,vi="[object Arguments]",$i="[object Array]",_i="[object Boolean]",mi="[object Date]",Ai="[object Error]",wi="[object Function]",Ti="[object Map]",Oi="[object Number]",Si="[object Object]",Ci="[object RegExp]",ji="[object Set]",Ei="[object String]",Ii="[object WeakMap]",Pi="[object ArrayBuffer]",xi="[object DataView]",Mi="[object Float32Array]",Ni="[object Float64Array]",Li="[object Int8Array]",Ri="[object Int16Array]",Di="[object Int32Array]",Fi="[object Uint8Array]",Bi="[object Uint8ClampedArray]",Ui="[object Uint16Array]",Gi="[object Uint32Array]",g={};g[Mi]=g[Ni]=g[Li]=g[Ri]=g[Di]=g[Fi]=g[Bi]=g[Ui]=g[Gi]=!0,g[vi]=g[$i]=g[Pi]=g[_i]=g[xi]=g[mi]=g[Ai]=g[wi]=g[Ti]=g[Oi]=g[Si]=g[Ci]=g[ji]=g[Ei]=g[Ii]=!1;function Ki(e){return bi(e)&&yi(e.length)&&!!g[pi(e)]}var Hi=Ki;function qi(e){return function(t){return e(t)}}var ue=qi,z={exports:{}};z.exports,function(e,t){var r=Se,a=t&&!t.nodeType&&t,n=a&&!0&&e&&!e.nodeType&&e,s=n&&n.exports===a,i=s&&r.process,o=function(){try{var c=n&&n.require&&n.require("util").types;return c||i&&i.binding&&i.binding("util")}catch{}}();e.exports=o}(z,z.exports);var fe=z.exports,Vi=Hi,zi=ue,Je=fe,Qe=Je&&Je.isTypedArray,Ji=Qe?zi(Qe):Vi,We=Ji,Qi=Ys,Wi=ii,Yi=S,Xi=le,Zi=di,ki=We,eo=Object.prototype,to=eo.hasOwnProperty;function ro(e,t){var r=Yi(e),a=!r&&Wi(e),n=!r&&!a&&Xi(e),s=!r&&!a&&!n&&ki(e),i=r||a||n||s,o=i?Qi(e.length,String):[],c=o.length;for(var l in e)(t||to.call(e,l))&&!(i&&(l=="length"||n&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Zi(l,c)))&&o.push(l);return o}var Ye=ro,ao=Object.prototype;function no(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||ao;return e===r}var de=no;function so(e,t){return function(r){return e(t(r))}}var Xe=so,io=Xe,oo=io(Object.keys,Object),co=oo,lo=de,uo=co,fo=Object.prototype,ho=fo.hasOwnProperty;function go(e){if(!lo(e))return uo(e);var t=[];for(var r in Object(e))ho.call(e,r)&&r!="constructor"&&t.push(r);return t}var po=go,yo=Pe,bo=ze;function vo(e){return e!=null&&bo(e.length)&&!yo(e)}var Ze=vo,$o=Ye,_o=po,mo=Ze;function Ao(e){return mo(e)?$o(e):_o(e)}var J=Ao,wo=q,To=J;function Oo(e,t){return e&&wo(t,To(t),e)}var So=Oo;function Co(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var jo=Co,Eo=P,Io=de,Po=jo,xo=Object.prototype,Mo=xo.hasOwnProperty;function No(e){if(!Eo(e))return Po(e);var t=Io(e),r=[];for(var a in e)a=="constructor"&&(t||!Mo.call(e,a))||r.push(a);return r}var Lo=No,Ro=Ye,Do=Lo,Fo=Ze;function Bo(e){return Fo(e)?Ro(e,!0):Do(e)}var he=Bo,Uo=q,Go=he;function Ko(e,t){return e&&Uo(t,Go(t),e)}var Ho=Ko,Q={exports:{}};Q.exports,function(e,t){var r=T,a=t&&!t.nodeType&&t,n=a&&!0&&e&&!e.nodeType&&e,s=n&&n.exports===a,i=s?r.Buffer:void 0,o=i?i.allocUnsafe:void 0;function c(l,u){if(u)return l.slice();var d=l.length,h=o?o(d):new l.constructor(d);return l.copy(h),h}e.exports=c}(Q,Q.exports);var qo=Q.exports;function Vo(e,t){var r=-1,a=e.length;for(t||(t=Array(a));++r<a;)t[r]=e[r];return t}var zo=Vo;function Jo(e,t){for(var r=-1,a=e==null?0:e.length,n=0,s=[];++r<a;){var i=e[r];t(i,r,e)&&(s[n++]=i)}return s}var Qo=Jo;function Wo(){return[]}var ke=Wo,Yo=Qo,Xo=ke,Zo=Object.prototype,ko=Zo.propertyIsEnumerable,et=Object.getOwnPropertySymbols,ec=et?function(e){return e==null?[]:(e=Object(e),Yo(et(e),function(t){return ko.call(e,t)}))}:Xo,ge=ec,tc=q,rc=ge;function ac(e,t){return tc(e,rc(e),t)}var nc=ac;function sc(e,t){for(var r=-1,a=t.length,n=e.length;++r<a;)e[n+r]=t[r];return e}var tt=sc,ic=Xe,oc=ic(Object.getPrototypeOf,Object),rt=oc,cc=tt,lc=rt,uc=ge,fc=ke,dc=Object.getOwnPropertySymbols,hc=dc?function(e){for(var t=[];e;)cc(t,uc(e)),e=lc(e);return t}:fc,at=hc,gc=q,pc=at;function yc(e,t){return gc(e,pc(e),t)}var bc=yc,vc=tt,$c=S;function _c(e,t,r){var a=t(e);return $c(e)?a:vc(a,r(e))}var nt=_c,mc=nt,Ac=ge,wc=J;function Tc(e){return mc(e,wc,Ac)}var st=Tc,Oc=nt,Sc=at,Cc=he;function jc(e){return Oc(e,Cc,Sc)}var Ec=jc,Ic=j,Pc=T,xc=Ic(Pc,"DataView"),Mc=xc,Nc=j,Lc=T,Rc=Nc(Lc,"Promise"),Dc=Rc,Fc=j,Bc=T,Uc=Fc(Bc,"Set"),Gc=Uc,Kc=j,Hc=T,qc=Kc(Hc,"WeakMap"),Vc=qc,pe=Mc,ye=se,be=Dc,ve=Gc,$e=Vc,it=B,R=Me,ot="[object Map]",zc="[object Object]",ct="[object Promise]",lt="[object Set]",ut="[object WeakMap]",ft="[object DataView]",Jc=R(pe),Qc=R(ye),Wc=R(be),Yc=R(ve),Xc=R($e),E=it;(pe&&E(new pe(new ArrayBuffer(1)))!=ft||ye&&E(new ye)!=ot||be&&E(be.resolve())!=ct||ve&&E(new ve)!=lt||$e&&E(new $e)!=ut)&&(E=function(e){var t=it(e),r=t==zc?e.constructor:void 0,a=r?R(r):"";if(a)switch(a){case Jc:return ft;case Qc:return ot;case Wc:return ct;case Yc:return lt;case Xc:return ut}return t});var W=E,Zc=Object.prototype,kc=Zc.hasOwnProperty;function el(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&kc.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var tl=el,rl=T,al=rl.Uint8Array,dt=al,ht=dt;function nl(e){var t=new e.constructor(e.byteLength);return new ht(t).set(new ht(e)),t}var _e=nl,sl=_e;function il(e,t){var r=t?sl(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var ol=il,cl=/\w*$/;function ll(e){var t=new e.constructor(e.source,cl.exec(e));return t.lastIndex=e.lastIndex,t}var ul=ll,gt=D,pt=gt?gt.prototype:void 0,yt=pt?pt.valueOf:void 0;function fl(e){return yt?Object(yt.call(e)):{}}var dl=fl,hl=_e;function gl(e,t){var r=t?hl(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var pl=gl,yl=_e,bl=ol,vl=ul,$l=dl,_l=pl,ml="[object Boolean]",Al="[object Date]",wl="[object Map]",Tl="[object Number]",Ol="[object RegExp]",Sl="[object Set]",Cl="[object String]",jl="[object Symbol]",El="[object ArrayBuffer]",Il="[object DataView]",Pl="[object Float32Array]",xl="[object Float64Array]",Ml="[object Int8Array]",Nl="[object Int16Array]",Ll="[object Int32Array]",Rl="[object Uint8Array]",Dl="[object Uint8ClampedArray]",Fl="[object Uint16Array]",Bl="[object Uint32Array]";function Ul(e,t,r){var a=e.constructor;switch(t){case El:return yl(e);case ml:case Al:return new a(+e);case Il:return bl(e,r);case Pl:case xl:case Ml:case Nl:case Ll:case Rl:case Dl:case Fl:case Bl:return _l(e,r);case wl:return new a;case Tl:case Cl:return new a(e);case Ol:return vl(e);case Sl:return new a;case jl:return $l(e)}}var Gl=Ul,Kl=P,bt=Object.create,Hl=function(){function e(){}return function(t){if(!Kl(t))return{};if(bt)return bt(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),ql=Hl,Vl=ql,zl=rt,Jl=de;function Ql(e){return typeof e.constructor=="function"&&!Jl(e)?Vl(zl(e)):{}}var Wl=Ql,Yl=W,Xl=C,Zl="[object Map]";function kl(e){return Xl(e)&&Yl(e)==Zl}var eu=kl,tu=eu,ru=ue,vt=fe,$t=vt&&vt.isMap,au=$t?ru($t):tu,nu=au,su=W,iu=C,ou="[object Set]";function cu(e){return iu(e)&&su(e)==ou}var lu=cu,uu=lu,fu=ue,_t=fe,mt=_t&&_t.isSet,du=mt?fu(mt):uu,hu=du,gu=ce,pu=Rs,yu=He,bu=So,vu=Ho,$u=qo,_u=zo,mu=nc,Au=bc,wu=st,Tu=Ec,Ou=W,Su=tl,Cu=Gl,ju=Wl,Eu=S,Iu=le,Pu=nu,xu=P,Mu=hu,Nu=J,Lu=he,Ru=1,Du=2,Fu=4,At="[object Arguments]",Bu="[object Array]",Uu="[object Boolean]",Gu="[object Date]",Ku="[object Error]",wt="[object Function]",Hu="[object GeneratorFunction]",qu="[object Map]",Vu="[object Number]",Tt="[object Object]",zu="[object RegExp]",Ju="[object Set]",Qu="[object String]",Wu="[object Symbol]",Yu="[object WeakMap]",Xu="[object ArrayBuffer]",Zu="[object DataView]",ku="[object Float32Array]",ef="[object Float64Array]",tf="[object Int8Array]",rf="[object Int16Array]",af="[object Int32Array]",nf="[object Uint8Array]",sf="[object Uint8ClampedArray]",of="[object Uint16Array]",cf="[object Uint32Array]",f={};f[At]=f[Bu]=f[Xu]=f[Zu]=f[Uu]=f[Gu]=f[ku]=f[ef]=f[tf]=f[rf]=f[af]=f[qu]=f[Vu]=f[Tt]=f[zu]=f[Ju]=f[Qu]=f[Wu]=f[nf]=f[sf]=f[of]=f[cf]=!0,f[Ku]=f[wt]=f[Yu]=!1;function Y(e,t,r,a,n,s){var i,o=t&Ru,c=t&Du,l=t&Fu;if(r&&(i=n?r(e,a,n,s):r(e)),i!==void 0)return i;if(!xu(e))return e;var u=Eu(e);if(u){if(i=Su(e),!o)return _u(e,i)}else{var d=Ou(e),h=d==wt||d==Hu;if(Iu(e))return $u(e,o);if(d==Tt||d==At||h&&!n){if(i=c||h?{}:ju(e),!o)return c?Au(e,vu(i,e)):mu(e,bu(i,e))}else{if(!f[d])return n?e:{};i=Cu(e,d,o)}}s||(s=new gu);var w=s.get(e);if(w)return w;s.set(e,i),Mu(e)?e.forEach(function(v){i.add(Y(v,t,r,v,e,s))}):Pu(e)&&e.forEach(function(v,_){i.set(_,Y(v,t,r,_,e,s))});var m=l?c?Tu:wu:c?Lu:Nu,A=u?void 0:m(e);return pu(A||e,function(v,_){A&&(_=v,v=e[_]),yu(i,_,Y(v,t,r,_,e,s))}),i}var Ot=Y,lf="__lodash_hash_undefined__";function uf(e){return this.__data__.set(e,lf),this}var ff=uf;function df(e){return this.__data__.has(e)}var hf=df,gf=ie,pf=ff,yf=hf;function X(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new gf;++t<r;)this.add(e[t])}X.prototype.add=X.prototype.push=pf,X.prototype.has=yf;var bf=X;function vf(e,t){for(var r=-1,a=e==null?0:e.length;++r<a;)if(t(e[r],r,e))return!0;return!1}var $f=vf;function _f(e,t){return e.has(t)}var mf=_f,Af=bf,wf=$f,Tf=mf,Of=1,Sf=2;function Cf(e,t,r,a,n,s){var i=r&Of,o=e.length,c=t.length;if(o!=c&&!(i&&c>o))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var d=-1,h=!0,w=r&Sf?new Af:void 0;for(s.set(e,t),s.set(t,e);++d<o;){var m=e[d],A=t[d];if(a)var v=i?a(A,m,d,t,e,s):a(m,A,d,e,t,s);if(v!==void 0){if(v)continue;h=!1;break}if(w){if(!wf(t,function(_,I){if(!Tf(w,I)&&(m===_||n(m,_,r,a,s)))return w.push(I)})){h=!1;break}}else if(!(m===A||n(m,A,r,a,s))){h=!1;break}}return s.delete(e),s.delete(t),h}var St=Cf;function jf(e){var t=-1,r=Array(e.size);return e.forEach(function(a,n){r[++t]=[n,a]}),r}var Ef=jf;function If(e){var t=-1,r=Array(e.size);return e.forEach(function(a){r[++t]=a}),r}var Pf=If,Ct=D,jt=dt,xf=ne,Mf=St,Nf=Ef,Lf=Pf,Rf=1,Df=2,Ff="[object Boolean]",Bf="[object Date]",Uf="[object Error]",Gf="[object Map]",Kf="[object Number]",Hf="[object RegExp]",qf="[object Set]",Vf="[object String]",zf="[object Symbol]",Jf="[object ArrayBuffer]",Qf="[object DataView]",Et=Ct?Ct.prototype:void 0,me=Et?Et.valueOf:void 0;function Wf(e,t,r,a,n,s,i){switch(r){case Qf:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Jf:return!(e.byteLength!=t.byteLength||!s(new jt(e),new jt(t)));case Ff:case Bf:case Kf:return xf(+e,+t);case Uf:return e.name==t.name&&e.message==t.message;case Hf:case Vf:return e==t+"";case Gf:var o=Nf;case qf:var c=a&Rf;if(o||(o=Lf),e.size!=t.size&&!c)return!1;var l=i.get(e);if(l)return l==t;a|=Df,i.set(e,t);var u=Mf(o(e),o(t),a,n,s,i);return i.delete(e),u;case zf:if(me)return me.call(e)==me.call(t)}return!1}var Yf=Wf,It=st,Xf=1,Zf=Object.prototype,kf=Zf.hasOwnProperty;function ed(e,t,r,a,n,s){var i=r&Xf,o=It(e),c=o.length,l=It(t),u=l.length;if(c!=u&&!i)return!1;for(var d=c;d--;){var h=o[d];if(!(i?h in t:kf.call(t,h)))return!1}var w=s.get(e),m=s.get(t);if(w&&m)return w==t&&m==e;var A=!0;s.set(e,t),s.set(t,e);for(var v=i;++d<c;){h=o[d];var _=e[h],I=t[h];if(a)var zt=i?a(I,_,h,t,e,s):a(_,I,h,e,t,s);if(!(zt===void 0?_===I||n(_,I,r,a,s):zt)){A=!1;break}v||(v=h=="constructor")}if(A&&!v){var ee=e.constructor,te=t.constructor;ee!=te&&"constructor"in e&&"constructor"in t&&!(typeof ee=="function"&&ee instanceof ee&&typeof te=="function"&&te instanceof te)&&(A=!1)}return s.delete(e),s.delete(t),A}var td=ed,Ae=ce,rd=St,ad=Yf,nd=td,Pt=W,xt=S,Mt=le,sd=We,id=1,Nt="[object Arguments]",Lt="[object Array]",Z="[object Object]",od=Object.prototype,Rt=od.hasOwnProperty;function cd(e,t,r,a,n,s){var i=xt(e),o=xt(t),c=i?Lt:Pt(e),l=o?Lt:Pt(t);c=c==Nt?Z:c,l=l==Nt?Z:l;var u=c==Z,d=l==Z,h=c==l;if(h&&Mt(e)){if(!Mt(t))return!1;i=!0,u=!1}if(h&&!u)return s||(s=new Ae),i||sd(e)?rd(e,t,r,a,n,s):ad(e,t,c,r,a,n,s);if(!(r&id)){var w=u&&Rt.call(e,"__wrapped__"),m=d&&Rt.call(t,"__wrapped__");if(w||m){var A=w?e.value():e,v=m?t.value():t;return s||(s=new Ae),n(A,v,r,a,s)}}return h?(s||(s=new Ae),nd(e,t,r,a,n,s)):!1}var ld=cd,ud=ld,Dt=C;function Ft(e,t,r,a,n){return e===t?!0:e==null||t==null||!Dt(e)&&!Dt(t)?e!==e&&t!==t:ud(e,t,r,a,Ft,n)}var fd=Ft,dd=ce,hd=fd,gd=1,pd=2;function yd(e,t,r,a){var n=r.length,s=n,i=!a;if(e==null)return!s;for(e=Object(e);n--;){var o=r[n];if(i&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++n<s;){o=r[n];var c=o[0],l=e[c],u=o[1];if(i&&o[2]){if(l===void 0&&!(c in e))return!1}else{var d=new dd;if(a)var h=a(l,u,c,e,t,d);if(!(h===void 0?hd(u,l,gd|pd,a,d):h))return!1}}return!0}var bd=yd,vd=P;function $d(e){return e===e&&!vd(e)}var _d=$d,md=_d,Ad=J;function wd(e){for(var t=Ad(e),r=t.length;r--;){var a=t[r],n=e[a];t[r]=[a,n,md(n)]}return t}var Td=wd;function Od(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var Sd=Od,Cd=bd,jd=Td,Ed=Sd;function Id(e){var t=jd(e);return t.length==1&&t[0][2]?Ed(t[0][0],t[0][1]):function(r){return r===e||Cd(r,e,t)}}var Pd=Id,xd=Ot,Md=Pd,Nd=1;function Ld(e){return Md(xd(e,Nd))}var Rd=Ld;const Dd=O(Rd);var Fd=Ot,Bd=1,Ud=4;function Gd(e){return Fd(e,Bd|Ud)}var Kd=Gd;const Bt=O(Kd);class we{constructor({items:t=[],identifierName:r="id",getNewId:a}={}){b(this,"sequence",0);b(this,"items",[]);b(this,"database",null);b(this,"name",null);b(this,"identifierName","id");b(this,"getNewId");if(!Array.isArray(t))throw new Error("Can't initialize a Collection with anything else than an array of items");this.identifierName=r,this.getNewId=a||this.getNewIdFromSequence,t.map(this.addOne.bind(this))}setDatabase(t){this.database=t}setName(t){this.name=t}_oneToManyEmbedder(t){if(this.name==null)throw new Error("Can't embed references without a collection name");const a=`${this.name.slice(0,-1)}_id`;return n=>{if(this.database==null)throw new Error("Can't embed references without a database");const s=this.database.collections[t];if(!s)throw new Error(`Can't embed a non-existing collection ${t}`);return Array.isArray(n[t])?n[t]=s.getAll({filter:i=>n[t].indexOf(i[s.identifierName])!==-1}):n[t]=s.getAll({filter:i=>i[a]===n[this.identifierName]}),n}}_manyToOneEmbedder(t){const r=`${t}s`,a=`${t}_id`;return n=>{if(this.database==null)throw new Error("Can't embed references without a database");const s=this.database.collections[r];if(!s)throw new Error(`Can't embed a non-existing collection ${t}`);try{n[t]=s.getOne(n[a])}catch{}return n}}_itemEmbedder(t){const a=(Array.isArray(t)?t:[t]).map(n=>n.endsWith("s")?this._oneToManyEmbedder(n):this._manyToOneEmbedder(n));return n=>a.reduce((s,i)=>i(s),n)}getCount(t){return this.getAll(t).length}getAll(t){let r=this.items.slice(0);return t&&(r=r.map(a=>Object.assign({},a)),t.embed&&this.database&&(r=r.map(this._itemEmbedder(t.embed))),t.filter&&(r=Gt(r,t.filter)),t.sort&&(r=zd(r,t.sort)),t.range&&(r=Jd(r,t.range))),r}getIndex(t){return this.items.findIndex(r=>r[this.identifierName]==t)}getOne(t,r){const a=this.getIndex(t);if(a===-1)throw new Error(`No item with identifier ${t}`);let n=this.items[a];return n=Object.assign({},n),r!=null&&r.embed&&this.database&&(n=this._itemEmbedder(r.embed)(n)),n}getNewIdFromSequence(){return this.sequence++}addOne(t){const r=Bt(t),a=r[this.identifierName];if(a!=null){if(this.getIndex(a)!==-1)throw new Error(`An item with the identifier ${a} already exists`);typeof a=="number"&&(this.sequence=Math.max(this.sequence,a)+1)}else r[this.identifierName]=this.getNewId();return this.items.push(r),r}updateOne(t,r){const a=this.getIndex(t);if(a===-1)throw new Error(`No item with identifier ${t}`);for(const n in r)this.items[a][n]=r[n];return Object.assign({},this.items[a])}removeOne(t){const r=this.getIndex(t);if(r===-1)throw new Error(`No item with identifier ${t}`);const a=this.items[r];return this.items.splice(r,1),typeof t=="number"&&t==this.sequence-1&&this.sequence--,a}}const Hd=(e,t)=>e.reduce((r,a)=>r&&t(a),!0),qd=(e,t)=>e.reduce((r,a)=>r||t(a),!1),Vd=(e,t)=>e.reduce((r,a,n)=>{if(r!=null)return r;const s=e.slice(0,n+1).join("."),i=e.slice(n+1).join("."),o=y(t,s);return Array.isArray(o)&&n<e.length-1?[s,i]:void 0},void 0),Ut=(e,t)=>{if(e.indexOf("_q")!==-1){const r=e.replace(/(_q)$/,""),a=new RegExp(t.toString(),"i");return n=>{var s;return((s=y(n,r))==null?void 0:s.toString().match(a))!==null}}if(e.indexOf("_lte")!==-1){const r=e.replace(/(_lte)$/,"");return a=>y(a,r)<=t}if(e.indexOf("_gte")!==-1){const r=e.replace(/(_gte)$/,"");return a=>y(a,r)>=t}if(e.indexOf("_lt")!==-1){const r=e.replace(/(_lt)$/,"");return a=>y(a,r)<t}if(e.indexOf("_gt")!==-1){const r=e.replace(/(_gt)$/,"");return a=>y(a,r)>t}if(e.indexOf("_neq_any")!==-1){const r=e.replace(/(_neq_any)$/,""),a=Array.isArray(t)?t:[t];return n=>a.every(s=>y(n,r)!=s)}if(e.indexOf("_neq")!==-1){const r=e.replace(/(_neq)$/,"");return a=>y(a,r)!=t}if(e.indexOf("_eq_any")!==-1){const r=e.replace(/(_eq_any)$/,""),a=Array.isArray(t)?t:[t];return n=>a.some(s=>y(n,r)==s)}if(e.indexOf("_eq")!==-1){const r=e.replace(/(_eq)$/,"");return a=>y(a,r)==t}if(e.indexOf("_inc_any")!==-1){const r=e.replace(/(_inc_any)$/,""),a=Array.isArray(t)?t:[t];return n=>a.some(s=>{const i=y(n,r);return Array.isArray(i)||typeof i=="string"?i.includes(s):!1})}if(e.indexOf("_inc")!==-1){const r=e.replace(/(_inc)$/,""),a=Array.isArray(t)?t:[t];return n=>a.every(s=>{const i=y(n,r);return Array.isArray(i)||typeof i=="string"?i.includes(s):!1})}if(e.indexOf("_ninc_any")!==-1){const r=e.replace(/(_ninc_any)$/,""),a=Array.isArray(t)?t:[t];return n=>a.every(s=>{const i=y(n,r);return Array.isArray(i)||typeof i=="string"?!i.includes(s):!1})}return Array.isArray(t)?r=>Array.isArray(y(r,e))?Hd(t,a=>{const n=y(r,e);return Array.isArray(n)?qd(n,s=>s==a):!1}):t.filter(a=>a==y(r,e)).length>0:t==null?r=>y(r,e)==null:typeof t=="object"?r=>Dd(t)(y(r,e)):r=>{const a=y(r,e);return Array.isArray(a)&&typeof t=="string"?a.indexOf(t)!==-1:typeof a=="boolean"&&typeof t=="string"?a===(t==="true"):a==t}};function Gt(e,t){if(typeof t=="function")return e.filter(t);if(t instanceof Object){const r=Object.keys(t).map(a=>{if(a==="q"&&typeof t.q=="string"){const i=Qd(t.q),o=c=>{for(const l in c){const u=c[l];if(typeof u=="object"&&o(u)||u&&typeof u=="string"&&u.match&&u.match(i)!==null)return!0}return!1};return o}const n=a.split("."),s=t[a];return n.length>1?i=>{const o=Vd(n,i);if(o){const[c,l]=o,u=y(i,c);return Array.isArray(u)?Gt(u,{[l]:s}).length>0:!1}return Ut(a,s)(i)}:Ut(a,s)});return e.filter(a=>r.reduce((n,s)=>n&&s(a),!0))}throw new Error("Unsupported filter type")}function zd(e,t){if(typeof t=="function")return e.sort(t);if(typeof t=="string")return e.sort((r,a)=>{const n=y(r,t),s=y(a,t);return n>s?1:n<s?-1:0});if(Array.isArray(t)){const r=t[0],a=t[1].toLowerCase()==="asc"?1:-1;return e.sort((n,s)=>{const i=y(n,r),o=y(s,r);return i>o?a:i<o?-1*a:0})}throw new Error("Unsupported sort type")}function Jd(e,t){if(Array.isArray(t))return e.slice(t[0],t[1]!==void 0?t[1]+1:void 0);throw new Error("Unsupported range type")}function Qd(e){const n=e.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&").split(" ").map(i=>`(${i})`).join("|");return new RegExp(n,"i")}class Kt{constructor(t){b(this,"obj",null);b(this,"database",null);b(this,"name",null);if(!(t instanceof Object))throw new Error("Can't initialize a Single with anything except an object");this.obj=Bt(t)}setDatabase(t){this.database=t}setName(t){this.name=t}_oneToManyEmbedder(t){return r=>{if(this.database==null)throw new Error("Can't embed references without a database");const a=this.database.collections[t];if(!a)throw new Error(`Can't embed a non-existing collection ${t}`);return r[t]=a.getAll({filter:n=>r[t].indexOf(n[a.identifierName])!==-1}),r}}_manyToOneEmbedder(t){const r=`${t}s`,a=`${t}_id`;return n=>{if(this.database==null)throw new Error("Can't embed references without a database");const s=this.database.collections[r];if(!s)throw new Error(`Can't embed a non-existing collection ${t}`);try{n[t]=s.getOne(n[a])}catch{}return n}}_itemEmbedder(t){const a=(Array.isArray(t)?t:[t]).map(n=>n.endsWith("s")?this._oneToManyEmbedder(n):this._manyToOneEmbedder(n));return n=>a.reduce((s,i)=>i(s),n)}getOnly(t){let r=this.obj;return t!=null&&t.embed&&this.database&&(r=Object.assign({},r),r=this._itemEmbedder(t.embed)(r)),r}updateOnly(t){if(this.obj==null)throw new Error("Can't update a non-existing object");for(const r in t)this.obj[r]=t[r];return this.obj}}class Ht{constructor({data:t,identifierName:r="id",getNewId:a}={}){b(this,"identifierName","id");b(this,"collections",{});b(this,"singles",{});b(this,"getNewId");this.getNewId=a,this.identifierName=r,t&&this.init(t)}init(t){for(const r in t){const a=t[r];Array.isArray(a)?this.addCollection(r,new we({items:a,identifierName:this.identifierName,getNewId:this.getNewId})):this.addSingle(r,new Kt(a))}}addCollection(t,r){this.collections[t]=r,r.setDatabase(this),r.setName(t)}getCollection(t){return this.collections[t]}getCollectionNames(){return Object.keys(this.collections)}addSingle(t,r){this.singles[t]=r,r.setDatabase(this),r.setName(t)}getSingle(t){return this.singles[t]}getSingleNames(){return Object.keys(this.singles)}getCount(t,r){return this.collections[t].getCount(r)}getAll(t,r){return this.collections[t].getAll(r)}getOne(t,r,a){return this.collections[t].getOne(r,a)}addOne(t,r){return Object.prototype.hasOwnProperty.call(this.collections,t)||this.addCollection(t,new we({items:[],identifierName:this.identifierName,getNewId:this.getNewId})),this.collections[t].addOne(r)}updateOne(t,r,a){return this.collections[t].updateOne(r,a)}removeOne(t,r){return this.collections[t].removeOne(r)}getOnly(t,r){return this.singles[t].getOnly()}updateOnly(t,r){return this.singles[t].updateOnly(r)}}class k{constructor({baseUrl:t="",defaultQuery:r=()=>({}),database:a,middlewares:n,...s}={}){b(this,"baseUrl","");b(this,"defaultQuery",()=>({}));b(this,"middlewares");b(this,"database");this.baseUrl=t,this.defaultQuery=r,this.middlewares=n||[],a?this.database=a:this.database=new Ht(s)}setDefaultQuery(t){this.defaultQuery=t}getContext(t){var a,n;for(const s of this.database.getSingleNames())if((a=t.url)!=null&&a.match(new RegExp(`^${this.baseUrl}\\/(${s})(\\/?.*)?$`)))return{...t,single:s};const r=(n=t.url)==null?void 0:n.match(new RegExp(`^${this.baseUrl}\\/([^\\/?]+)(\\/(\\w+|\\d+))?(\\?.*)?$`));if(r){const s=r[1],i=Object.assign({},this.defaultQuery(s),t.params);return{...t,collection:s,params:i}}return t}async handle(t){const r=this.getContext(t);let a=0;const n=[...this.middlewares],s=i=>{const o=n[a++];return o?o(i,s):this.handleRequest(i)};try{return await s(r)}catch(i){if(i instanceof Error)throw i;return i}}handleRequest(t){var s,i;for(const o of this.database.getSingleNames())if((s=t.url)!=null&&s.match(new RegExp(`^${this.baseUrl}\\/(${o})(\\/?.*)?$`))){if(t.method==="GET")try{return{status:200,body:this.database.getOnly(o),headers:{"Content-Type":"application/json"}}}catch{return{status:404,headers:{}}}if(t.method==="PUT")try{return t.requestBody==null?{status:400,headers:{}}:{status:200,body:this.database.updateOnly(o,t.requestBody),headers:{"Content-Type":"application/json"}}}catch{return{status:404,headers:{}}}if(t.method==="PATCH")try{return t.requestBody==null?{status:400,headers:{}}:{status:200,body:this.database.updateOnly(o,t.requestBody),headers:{"Content-Type":"application/json"}}}catch{return{status:404,headers:{}}}}const r=(i=t.url)==null?void 0:i.match(new RegExp(`^${this.baseUrl}\\/([^\\/?]+)(\\/(\\w+|\\d+))?(\\?.*)?$`));if(!r)return{status:404,headers:{}};const a=r[1],n=Object.assign({},this.defaultQuery(a),t.params);if(r[2]){if(!this.database.getCollection(a))return{status:404,headers:{}};const o=r[3];if(t.method==="GET")try{return{status:200,body:this.database.getOne(a,o,n),headers:{"Content-Type":"application/json"}}}catch{return{status:404,headers:{}}}if(t.method==="PUT")try{return t.requestBody==null?{status:400,headers:{}}:{status:200,body:this.database.updateOne(a,o,t.requestBody),headers:{"Content-Type":"application/json"}}}catch{return{status:404,headers:{}}}if(t.method==="PATCH")try{return t.requestBody==null?{status:400,headers:{}}:{status:200,body:this.database.updateOne(a,o,t.requestBody),headers:{"Content-Type":"application/json"}}}catch{return{status:404,headers:{}}}if(t.method==="DELETE")try{return{status:200,body:this.database.removeOne(a,o),headers:{"Content-Type":"application/json"}}}catch{return{status:404,headers:{}}}}else{if(t.method==="GET"){if(!this.database.getCollection(a))return{status:404,headers:{}};const o=this.database.getCount(a,n.filter?{filter:n.filter}:{});if(o>0){const c=this.database.getAll(a,n),l=n.range?n.range[0]:0,u=n.range&&n.range.length===2?Math.min(c.length-1+l,n.range[1]):c.length-1;return{status:c.length===o?200:206,body:c,headers:{"Content-Type":"application/json","Content-Range":`items ${l}-${u}/${o}`}}}return{status:200,body:[],headers:{"Content-Type":"application/json","Content-Range":"items */0"}}}if(t.method==="POST"){if(t.requestBody==null)return{status:400,headers:{}};const o=this.database.addOne(a,t.requestBody),c=`${this.baseUrl}/${a}/${o[this.database.getCollection(a).identifierName]}`;return{status:201,body:o,headers:{"Content-Type":"application/json",Location:c}}}}return{status:404,headers:{}}}addMiddleware(t){this.middlewares.push(t)}addCollection(t,r){this.database.addCollection(t,r)}getCollection(t){return this.database.getCollection(t)}getCollectionNames(){return this.database.getCollectionNames()}addSingle(t,r){this.database.addSingle(t,r)}getSingle(t){return this.database.getSingle(t)}getSingleNames(){return this.database.getSingleNames()}}function qt(e){if(!e)return{};const t={};return e.split("&").map(a=>{if(a.indexOf("=")===-1)t[a]=!0;else{let[n,s]=a.split("=");(s.indexOf("[")===0||s.indexOf("{")===0)&&(s=JSON.parse(s)),t[n.trim()]=s}}),t}class Te{constructor({loggingEnabled:t=!1,server:r,...a}={}){b(this,"loggingEnabled",!1);b(this,"server");this.server=r||new k(a),this.loggingEnabled=t}getHandler(){return async t=>{t.readyState=4;const r=this.getNormalizedRequest(t),a=await this.server.handle(r);this.respond(a,t)}}getNormalizedRequest(t){const r=typeof t=="string"?new Request(t):t,a=r.url?decodeURIComponent(r.url.slice(r.url.indexOf("?")+1)):"",n=qt(a);let s;if(r.requestBody)try{s=JSON.parse(r.requestBody)}catch{}return{url:r.url,headers:new Headers(t.requestHeaders),params:n,requestBody:s,method:r.method}}respond(t,r){const a={status:t.status,body:t.body??"",headers:t.headers??{}};Array.isArray(a.headers)?a.headers.find(n=>n.name.toLowerCase()==="content-type")||a.headers.push({name:"Content-Type",value:"application/json"}):a.headers["Content-Type"]||(a.headers["Content-Type"]="application/json"),r.readyState=1,r.respond(a.status,a.headers,JSON.stringify(a.body)),this.log(r,a)}log(t,r){this.loggingEnabled&&(console.group?(console.groupCollapsed(t.method,t.url,"(FakeRest)"),console.group("request"),console.log(t.method,t.url),console.log("headers",t.requestHeaders),console.log("body   ",t.requestBody),console.groupEnd(),console.group("response",r.status),console.log("headers",r.headers),console.log("body   ",r.body),console.groupEnd(),console.groupEnd()):(console.log("FakeRest request ",t.method,t.url,"headers",t.requestHeaders,"body",t.requestBody),console.log("FakeRest response",r.status,"headers",r.headers,"body",r.body)))}toggleLogging(){this.loggingEnabled=!this.loggingEnabled}}const Wd=e=>new Te(e).getHandler(),Yd=Te;class Oe{constructor({loggingEnabled:t=!1,server:r,...a}={}){b(this,"loggingEnabled",!1);b(this,"server");this.server=r||new k(a),this.loggingEnabled=t}getHandler(){return async(r,a)=>{const n=new Request(r,a),s=await this.getNormalizedRequest(n),i=await this.server.handle(s);return this.log(n,i,s),i}}async getNormalizedRequest(t){const r=typeof t=="string"?new Request(t):t,a=r.url?decodeURIComponent(r.url.slice(r.url.indexOf("?")+1)):"",n=qt(a),s=await r.text();let i;try{i=JSON.parse(s)}catch{}return{url:r.url,headers:r.headers,params:n,requestBody:i,method:r.method}}log(t,r,a){this.loggingEnabled&&(console.group?(console.groupCollapsed(a.method,a.url,"(FakeRest)"),console.group("request"),console.log(a.method,a.url),console.log("headers",t.headers),console.log("body   ",t.requestJson),console.groupEnd(),console.group("response",r.status),console.log("headers",r.headers),console.log("body   ",r.body),console.groupEnd(),console.groupEnd()):(console.log("FakeRest request ",a.method,a.url,"headers",t.headers,"body",t.requestJson),console.log("FakeRest response",r.status,"headers",r.headers,"body",r.body)))}toggleLogging(){this.loggingEnabled=!this.loggingEnabled}}const Xd=e=>new Oe(e).getHandler(),Zd=Oe;class Vt{constructor({server:t,...r}){b(this,"server");this.server=t||new k(r)}getHandler(){return async({request:t})=>{const r=await this.getNormalizedRequest(t),a=await this.server.handle(r);return new Response(JSON.stringify(a.body),{status:a.status,headers:a.headers})}}async getNormalizedRequest(t){const r=new URL(t.url),a=Object.fromEntries(Array.from(new URLSearchParams(r.search).entries()).map(([s,i])=>[s,JSON.parse(i)]));let n;try{const s=await t.text();n=JSON.parse(s)}catch{}return{url:t.url,headers:t.headers,params:a,requestBody:n,method:t.method}}}const kd=e=>new Vt(e).getHandler(),eh=e=>(t,r)=>new Promise(a=>{setTimeout(()=>{a(r(t))},e)});p.Collection=we,p.Database=Ht,p.FetchMockAdapter=Oe,p.FetchServer=Zd,p.MswAdapter=Vt,p.Server=Yd,p.SimpleRestServer=k,p.Single=Kt,p.SinonAdapter=Te,p.getFetchMockHandler=Xd,p.getMswHandler=kd,p.getSinonHandler=Wd,p.withDelay=eh,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=fakerest.min.umd.cjs.map
